name: Build & Test

on: [push]

jobs:
  Ubuntu-1604:
    runs-on: ubuntu-16.04
    steps:
    - uses: actions/checkout@v1
    - name: apt
      run: sudo apt install ruby gperf bison
    - name: build and test
      run: ./minirake -j4 all test
      env:
        MRUBY_CONFIG: travis_config.rb

  Ubuntu-1804:
    runs-on: ubuntu-18.04
    steps:
    - uses: actions/checkout@v1
    - name: apt
      run: sudo apt install ruby gperf bison
    - name: build and test
      run: ./minirake -j4 all test
      env:
        MRUBY_CONFIG: travis_config.rb

  macOS:
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v1
    - name: brew
      run: brew install ruby gperf bison
    - name: build and test
      run: ruby ./minirake -j4 all test
      env:
        MRUBY_CONFIG: travis_config.rb

  Windows:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v1
    - name: chocolatey
      run: chocolatey install -y ruby winflexbison gperf mingw
    - name: build and test
      run: ruby ./minirake -j4 all test
      env:
        MRUBY_CONFIG: travis_config.rb
